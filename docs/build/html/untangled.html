<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>untangled &#8212; UnTANGLeD  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Conservation Analysis" href="conservation.html" />
    <link rel="prev" title="clusterOptimiser" href="clusterOptimiser.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="untangled">
<h1>untangled<a class="headerlink" href="#untangled" title="Link to this heading">¶</a></h1>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">untangled</span></code> is the core clustering function of the UnTANGLeD pipeline that performs the final hierarchical clustering analysis using the consensus matrix generated by <code class="docutils literal notranslate"><span class="pre">clusterOptimiser</span></code>. This function takes the optimal number of clusters (determined from silhouette analysis) and produces final cluster assignments along with internal quality metrics.</p>
</section>
<section id="methodology">
<h2>Methodology<a class="headerlink" href="#methodology" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">untangled</span></code> function implements the following analytical workflow:</p>
<ol class="arabic simple">
<li><p><strong>Hierarchical Clustering:</strong> Applies hierarchical clustering (Ward’s method) to the consensus matrix using the specified optimal cluster number and cuts the dendrogram to produce final cluster memberships for all samples</p></li>
<li><p><strong>Quality Assessment:</strong> Computes multiple internal validation metrics:
- <strong>Average Silhouette:</strong> Measures how well samples fit within their assigned clusters
- <strong>Average Correlation:</strong> Calculates within-cluster correlation using original scaled data matrix
- <strong>Cluster Size / Names:</strong> Reports cluster membership statistics</p></li>
<li><p><strong>Visualization:</strong> Generates diagnostic plots showing the distribution of clusters along silhouette and correlation scores</p></li>
<li><p><strong>Output Generation:</strong> Saves cluster assignments and summary statistics</p></li>
</ol>
</section>
<section id="input-and-output">
<h2>Input and Output<a class="headerlink" href="#input-and-output" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt><strong>Input Requirements:</strong></dt><dd><ul class="simple">
<li><p>Output directory from a completed <code class="docutils literal notranslate"><span class="pre">clusterOptimiser</span></code> run containing:
- <code class="docutils literal notranslate"><span class="pre">consensus_matrix.rds</span></code>: Consensus matrix from multi-resolution clustering
- <code class="docutils literal notranslate"><span class="pre">seurat_scaled_matrix.rds</span></code>: Seurat object with original scaled data matrix</p></li>
<li><p>Optimal cluster number (either from automatic detection or manual selection from silhouette plot)</p></li>
</ul>
</dd>
<dt><strong>Output Files:</strong></dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gene_subgrp.rds</span></code>: Final cluster assignments for all samples/genes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UnTANGLeD_gene_cluster_summary.txt</span></code>: Comprehensive cluster quality metrics and statistics with the following columns:
- <code class="docutils literal notranslate"><span class="pre">cluster</span></code>: Cluster ID
- <code class="docutils literal notranslate"><span class="pre">mean_sil</span></code>: Average silhouette score for the cluster
- <code class="docutils literal notranslate"><span class="pre">mean_cor</span></code>: Average within-cluster correlation (absolute values)
- <code class="docutils literal notranslate"><span class="pre">clus_n</span></code>: Number of members in the cluster
- <code class="docutils literal notranslate"><span class="pre">names</span></code>: Comma-separated list of all members in the cluster</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">avg_silhouette_vs_correlation.pdf</span></code>: Diagnostic plot visualizing cluster quality relationships</p></li>
</ul>
</dd>
</dl>
</section>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">optimal_clusters</span></code>: An integer specifying the optimal number of clusters determined from the <code class="docutils literal notranslate"><span class="pre">clusterOptimiser</span></code> silhouette plot. This is the only required parameter. <strong>Required</strong>.</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">outdir</span></code>: (Optional) A character string specifying the directory path containing <code class="docutils literal notranslate"><span class="pre">clusterOptimiser</span></code> outputs and where new results will be saved. Must match the <code class="docutils literal notranslate"><span class="pre">outdir</span></code> used in <code class="docutils literal notranslate"><span class="pre">clusterOptimiser</span></code>. Default is <code class="docutils literal notranslate"><span class="pre">&quot;UnTANGLeD_output&quot;</span></code>.</p></li>
</ul>
</section>
<section id="cluster-quality-metrics">
<h2>Cluster Quality Metrics<a class="headerlink" href="#cluster-quality-metrics" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">untangled</span></code> computes several key metrics to assess cluster quality:</p>
<p><strong>Silhouette Score:</strong>
- Measures how similar a sample is to its own cluster compared to other clusters. Higher scores (e.g., &gt;0.5) indicate more robust cluster assignments, with values closer to 1 representing the strongest clustering confidence.</p>
<p><strong>Within-Cluster Correlation:</strong>
- Average Pearson correlation between samples within each cluster
- Higher values indicate greater cluster coherence, with values closer to 1 representing the strongest within-cluster similarity
- Measures feature similarity of clustered samples</p>
<p><strong>Cluster Size:</strong>
- Number of samples assigned to each cluster</p>
</section>
<section id="usage-examples">
<h2>Usage Examples<a class="headerlink" href="#usage-examples" title="Link to this heading">¶</a></h2>
<p><strong>Example 1: Basic Usage After clusterOptimiser</strong></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># After examining the silhouette plot from clusterOptimiser</span>
<span class="c1"># and determining 150 is the optimal cluster number</span>
<span class="nf">untangled</span><span class="p">(</span><span class="n">optimal_clusters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">150</span><span class="p">,</span>
<span class="w">          </span><span class="n">outdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;UnTANGLeD_output&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Example 2: Custom Output Directory</strong></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using a specific analysis directory</span>
<span class="nf">untangled</span><span class="p">(</span><span class="n">optimal_clusters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">200</span><span class="p">,</span>
<span class="w">          </span><span class="n">outdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;my_drug_screen_analysis&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Example 3: Testing Multiple Cluster Numbers</strong></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test several promising cluster numbers identified from silhouette plot</span>
<span class="kr">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">120</span><span class="p">,</span><span class="w"> </span><span class="m">150</span><span class="p">,</span><span class="w"> </span><span class="m">180</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">untangled</span><span class="p">(</span><span class="n">optimal_clusters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">,</span>
<span class="w">              </span><span class="n">outdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;analysis_k&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Example 4: Pipeline Integration</strong></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Complete pipeline workflow</span>
<span class="c1"># Step 1: Cluster optimization</span>
<span class="nf">clusterOptimiser</span><span class="p">(</span><span class="n">seu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my_seurat_object</span><span class="p">,</span>
<span class="w">                 </span><span class="n">outdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;drug_screen&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Manual examination of silhouette plot</span>
<span class="c1"># (examine drug_screen/average_silhouette_scores_by_cluster_number.pdf)</span>

<span class="c1"># Step 3: Main clustering with optimal k</span>
<span class="nf">untangled</span><span class="p">(</span><span class="n">optimal_clusters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">165</span><span class="p">,</span><span class="w">  </span><span class="c1"># chosen from silhouette plot</span>
<span class="w">          </span><span class="n">outdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;drug_screen&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="interpreting-results">
<h2>Interpreting Results<a class="headerlink" href="#interpreting-results" title="Link to this heading">¶</a></h2>
<p><strong>Cluster Summary File:</strong>
The <code class="docutils literal notranslate"><span class="pre">UnTANGLeD_gene_cluster_summary.txt</span></code> file contains essential information for cluster prioritization:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cluster  mean_sil  mean_cor  clus_n  names
1        0.67      0.43      45      comp1, comp2, comp3, ...
2        0.61      0.38      32      comp45, comp46, ...
3        0.59      0.41      78      comp77, comp78, ...
...
</pre></div>
</div>
<p><strong>Diagnostic Plot Interpretation:</strong>
The <code class="docutils literal notranslate"><span class="pre">avg_silhouette_vs_correlation.pdf</span></code> plot shows the relationship between silhouette scores and correlation metrics:</p>
<ul class="simple">
<li><p><strong>Upper-right quadrant:</strong> Best clusters (high silhouette, high correlation)</p></li>
</ul>
</section>
<section id="considerations-and-troubleshooting">
<h2>Considerations and Troubleshooting<a class="headerlink" href="#considerations-and-troubleshooting" title="Link to this heading">¶</a></h2>
<p><strong>Expected Runtime:</strong>
- Typically &lt; 1 minute
- Memory usage proportional to consensus matrix size</p>
<p><strong>Common Issues:</strong></p>
<ol class="arabic simple">
<li><p><strong>Missing input files:</strong> Ensure <code class="docutils literal notranslate"><span class="pre">clusterOptimiser</span></code> completed successfully</p></li>
<li><p><strong>Poor cluster quality:</strong> Consider different optimal cluster numbers or revisit preprocessing</p></li>
</ol>
<p><strong>Quality Control Checks:</strong>
- Verify reasonable distribution of cluster sizes
- Check that silhouette and correlation metrics show positive correlation
- Ensure summary statistics are within expected ranges</p>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">¶</a></h2>
<p>After running <code class="docutils literal notranslate"><span class="pre">untangled</span></code>, proceed with:</p>
<ul class="simple">
<li><p>Use conservation analysis functions (<code class="docutils literal notranslate"><span class="pre">gcc</span></code>, <code class="docutils literal notranslate"><span class="pre">cmc</span></code>) to assess cross-dataset stability</p></li>
<li><p>Examine biological pathway enrichment in top-ranked clusters</p></li>
<li><p>Validate findings using orthogonal datasets</p></li>
<li><p>Focus follow-up analyses on highest-ranked clusters</p></li>
<li><p>Investigate cluster-specific phenotypes or molecular signatures</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">untangled</span></code> function provides the final cluster assignments and quality metrics needed for downstream prioritisation and follow-up</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">UnTANGLeD</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="clusterOptimiser.html">clusterOptimiser</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">untangled</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#methodology">Methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="#input-and-output">Input and Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cluster-quality-metrics">Cluster Quality Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage-examples">Usage Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interpreting-results">Interpreting Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#considerations-and-troubleshooting">Considerations and Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conservation.html">Conservation Analysis</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="clusterOptimiser.html" title="previous chapter">clusterOptimiser</a></li>
      <li>Next: <a href="conservation.html" title="next chapter">Conservation Analysis</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Qiongyi Zhao & Shaine Bao.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/untangled.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>